---
title: "ãƒã‚±ãƒ¢ãƒ³APIã‚’ä½¿ã£ã¦GraphQLã‚’ä»Šæ›´è¦šãˆã‚‹ï¼"
emoji: "ğŸ¹"
type: "tech"
topics:
  - "graphql"
  - "react"
  - "pokemon"
published: true
published_at: "2021-08-19 23:18"
---

## ç›®çš„

æœ‰å¿—ã®æ–¹ãŒåˆ¶ä½œã•ã‚Œã¦ã„ã‚‹[GraphQL ã®ãƒã‚±ãƒ¢ãƒ³ API](https://github.com/lucasbento/graphql-pokemon)ã‚’ä½¿ã£ã¦
ãƒã‚±ãƒ¢ãƒ³æ¤œç´¢ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹éç¨‹ã§ React + TypeScript + GraphQL ã‚’è¦šãˆã‚‹ï¼

## å‰è¿°

æœ¬è¨˜äº‹ã§ä½œã£ãŸã‚¢ãƒ—ãƒªã¯ GitHub ã§å…¬é–‹ã—ã¦ã„ã‚‹ã®ã§ã€ã‚ˆã‹ã£ãŸã‚‰è¨˜äº‹ã‚’ä¸€ç·’ã«ç¢ºèªã—ã¦ãã ã•ã„

@[card](https://github.com/azuharu07/pokemon-graphql-practice)

## äº‹å‰æº–å‚™

### ã¨ã‚Šã‚ãˆãš React + TypeScript ç’°å¢ƒã‚’ä½œã‚‹

```sh
npx create-react-app pokemon-graphql-practice --template typescript
```

ãŸã£ãŸã®ã“ã‚Œã ã‘ã§ React + TypeScript ç’°å¢ƒãŒä½œæˆã§ãã‚‹ï¼ˆç¥ï¼‰

```sh
cd pokemon-graphql-practice
yarn start
```

ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤ã—ã¾ã—ã‚‡ã†

- src/App.css
- src/App.text.tsx
- src/logo.svg
- src/setupTest.ts

App.tsx ã‚‚ä¸è¦ãªè¨˜è¿°ã‚’æ¶ˆã—ã¦ã¨ã‚Šã‚ãˆãšã‚¹ãƒƒã‚­ãƒªã•ã›ã¾ã™

```js
function App() {
  return <div>pokemon-graphql-practice</div>;
}
```

- src/App.css

### graphql-codegen ã§å‹å®šç¾©ã‚’ä½œã‚‹

GraphQL ã® Schema æƒ…å ±ã‹ã‚‰å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã‚Œã‚‹ã™ã”ã„ã‚„ã¤ã§ã™

### [å…¬å¼ Docs](https://www.graphql-code-generator.com/docs/getting-started/installation)ã® Installation ã‚’å‚è€ƒã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

```sh
yarn add graphql
yarn add -D @graphql-codegen/cli
yarn add -D @graphql-codegen/schema-ast // schema.graphqlã‚’è‡ªå‹•ã§ä½œã£ã¦ãã‚Œã‚‹ï¼
```

#### ã‚»ãƒƒãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†

```sh
yarn graphql-codegen init
```

è‰²ã€…èã‹ã‚Œã‚‹ã‘ã©ã¨ã‚Šã‚ãˆãšå…¨éƒ¨ Enter ã§ã™ã£é£›ã°ã—ã¦ OK ã§ã™
script åã‚’èã‹ã‚Œã‚‹ã®ã§ãã“ã ã‘`generate`ã¨å…¥åŠ›ã—ã¾ã™
graphql-codegen ã‚’å®Ÿè¡Œã™ã‚‹ã®ã«`yarn generate`ã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™
codegen.yml ãŒä½œæˆã•ã‚Œã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™

```yml
schema: "https://graphql-pokemon2.vercel.app" # GraphiQLã‚’æŒ‡å®š
generates:
  ./src/@types/types.d.ts:
    plugins:
      - "typescript"
      - "typescript-operations" # fqueryã‚„mutationã§ä½¿ç”¨ã™ã‚‹Operationã¨ã‹ã®å‹å®šç¾©ã¾ã§ä½œã£ã¦ãã‚Œã‚‹
  ./schema.graphql: # ã“ã‚Œä»¥ä¸‹ã‚’è¨˜è¿°ã™ã‚‹ã¨schema.graphqlã‚’Documentã‹ã‚‰ä½œã£ã¦ãã‚Œã‚‹ï¼ˆï½½ï½ºï¾ï½²ï¼‰
    plugins:
      - schema-ast
```

ã“ã“ã¾ã§æ¥ãŸã‚‰ã‚ã¨ã¯å®Ÿè¡Œã™ã‚‹ã®ã¿ã§ã™ï¼

```sh
yarn generate
```

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™

- ./src/@types/types.d.ts
- ./schema.graphql

### Apollo ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

[Apollo](https://www.apollographql.com/)ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ç°¡å˜ã« GraphQL ã‚’æ“ä½œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™

```sh
yarn add @apollo/client
```

## å®Ÿè£…

ã“ã“ã¾ã§æ¥ãŸã‚‰ã‚‚ã†æº–å‚™ä¸‡ç«¯ï¼
æ—©é€Ÿå®Ÿè£…ã«å…¥ã‚Šã¾ã—ã‚‡ã†ï¼ï¼ï¼

...ã¨è¨€ã„ãŸã„ã¨ã“ã‚ã§ã™ãŒã€ãã®å‰ã« graphql-pokemon ãŒæä¾›ã—ã¦ã„ã‚‹ API ä»•æ§˜ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†

### Pikachu ã®ç•ªå·/åå‰/ç”»åƒ url ã‚’å–å¾—ã™ã‚‹ Query ã‚’è©¦ã™

[GraphiQL](https://graphql-pokemon2.vercel.app/)ã‚’é–‹ãã€å³ä¸Šã® Docs ã‚’é–‹ãã¾ã™ï¼ˆDocs ã®è¦‹æ–¹ã¯çœç•¥ã—ã¾ã™ï¼‰

query:Query ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€query ã¨ pokemons ã¨ pokemon ã® Fields ãŒã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-05-05 18.35.31.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/461616/255c3930-9891-d65a-0193-a73b2a7fbe5d.png)

ä»Šå› Pikachu ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ãŸã„ã®ã§ã€pokemon ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€`pokemon(id: String,name: String): Pokemon`ã¨ã‚ã‚Šã¾ã™ã­

String å‹ã® id ã¾ãŸã¯ name ã‚’å¼•æ•°ã¨ã—ã¦æ¸¡ã™ã“ã¨ã§ã€Pokemon å‹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´ã™ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™

ã§ã¯ Pokemon å‹ã®è©³ç´°ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-05-05 18.35.37.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/461616/8558e25e-5ae7-d113-0688-c3e84c56b9e8.png)

Pokemon å‹ãŒæŒã¤ Field ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸ
ã„ã‚ã‚“ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™ãŒã¨ã‚Šã‚ãˆãšä»Šå›å¿…è¦ãªã®ã¯

- number
- name
- image

ã§ã™ã­
ã“ã‚Œã‚’å…ƒã«å·¦å´ã®ã‚¨ãƒ‡ã‚£ã‚¿ã§ Query ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-05-05 18.41.20.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/461616/5f4d2c05-55f1-e8d9-e1f7-2d244d116942.png)

serachPikachu Query ã‚’ä½œã‚Šã¾ã—ãŸ
ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨ pikachu ã®ãƒ‡ãƒ¼ã‚¿ãŒå–ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™

ã“ã®"data"ã‹ã‚‰å§‹ã¾ã‚‹ JSON ãŒã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ Query ã‚’å®Ÿè¡Œã—ãŸæ™‚ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã•ã‚Œã¾ã™

GraphiQL è¶…ä¾¿åˆ©ï¼ï¼ï¼

ã•ã¦ã“ã‚Œã‚’å®Ÿéš›ã«ã‚¢ãƒ—ãƒªã§å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

### Apollo ã®æº–å‚™

src/graphql/client.ts ã‚’ä½œæˆã—ã€ãã“ã« Apollo ã‚’ä½¿ã†ãŸã‚ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç”¨æ„ã—ã¦ã‚ã’ã¾ã™
ApolloClient ã‚’åˆæœŸåŒ–ã—ã¾ã™

```src/graphql/client.ts
import { ApolloClient, InMemoryCache } from "@apollo/client"

const apolloClient = new ApolloClient({
    uri: "https://graphql-pokemon2.vercel.app/",
    cache: new InMemoryCache(),
})

export { apolloClient }
```

uri ã«ã¯ GraphiQL ã‚’ã€cache ã«ã¯ InMemoryCache ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¸¡ã—ã¾ã™

cache ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§åŒã˜ã‚¯ã‚¨ãƒªãŒç™ºè¡Œã•ã‚ŒãŸå ´åˆã€è‡ªå‹•çš„ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰çµæœã‚’è¿”å´ã—ã¦ãã‚Œã‚‹ã®ã§ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒã‚ˆããªã‚‹ã¿ãŸã„ã§ã™
ã¨ã‚Šã‚ãˆãšå…¥ã‚Œã¦ãŠã„ã¦æã¯ç„¡ã„ã‹ã¨æ€ã„ã¾ã™

App.ts ã« ApolloProvider ã¨å…ˆã»ã©åˆæœŸåŒ–ã—ãŸ AppoloClient ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã€ApolloProvider ã§ã‚¢ãƒ—ãƒªå…¨ä½“ã‚’å›²ã£ã¦ã‚ã’ã¾ã™

```tsx
import { ApolloProvider } from "@apollo/client";
import { apolloClient } from "./graphql/client";

function App() {
  return (
    <ApolloProvider client={apolloClient}>
      {" "}
      // è¿½åŠ 
      <div>pokemon-graphql-practice</div>
    </ApolloProvider> // è¿½åŠ 
  );
}
```

ã“ã‚Œã§ã“ã® ApolloProvider ã«å›²ã‚ã‚Œã¦ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ã€GraphQL ã® query ã‚„ mutation ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™

### çµæœã‚’è¡¨ç¤ºã—ã‚ˆã†

GraphQL API ã‚’å®Ÿè¡Œã—ã¦çµæœã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã£ã¦ã„ãã¾ã™

src/graphql/queries.ts ã«å…ˆã»ã© GraphQL ã§ç¢ºèªã—ãŸ Query ã‚’è¨˜è¼‰ã—ã¦ãŠãã¾ã—ã‚‡ã†

gql ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«ã§ Query ã‚’æ›¸ãã¨ã„ã„æ„Ÿã˜ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œã£ã¦ãã‚Œã‚‹ã¿ãŸã„ã§ã™

```src/graphql/queries.ts
import gql from "graphql-tag"

export const searchPikachu = gql`
    query searchPikachu {
        pokemon(name: "pikachu") {
            number
            name
            image
        }
    }
`
```

src/components/SearchResultField.tsx ã‚’ä½œã£ã¦ã€Query ã‚’å®Ÿè¡Œã—çµæœã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã‚Šã¾ã™

```src/components/SearchResultField.tsx
import { useQuery } from "@apollo/client"
import { Query } from "../@types/types"
import { searchPikachu } from "../graphql/queries"

const SearchResultField = () => {
    const { loading, error, data } = useQuery<Query>(searchPikachu)

    if (loading) return <>"Loading..."</>
    if (error) return <>`Error! ${error.message}`</>

    return (
        <div>
            <div>No: {data?.pokemon?.number}</div>
            <div>Name: {data?.pokemon?.name}</div>
            {data?.pokemon?.image ? (
                <img src={data?.pokemon?.image} alt={data?.pokemon?.name ?? ""} />
            ) : (
                <div>no image.</div>
            )}
        </div>
    )
}
export { SearchResultField }
```

useQuery ã«ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã¨ã—ã¦ã€data ã®å‹ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™
@types ã‹ã‚‰ Query ã‚’ã¨ã£ã¦ãã¦æ¸¡ã™ã“ã¨ã§ã€ã¡ã‚ƒã‚“ã¨ data ãŒ Query å‹ã ã¨ VSCode ãŒåˆ¤å®šã—ã¦ãã‚Œã¾ã—ãŸ
å½“åˆã®æƒ³å®šã§ã¯ data ã¯ Pokemon å‹ã«ãªã‚‹ã¨æ€ã£ã¦ã„ã¾ã—ãŸãŒã€data ã¯ GraphiQL ã§ã®çµæœã® JSON ï¼ˆä»¥ä¸‹ï¼‰ã®ã‚ˆã†ã« pokemon ã‚­ãƒ¼ãŒä¸€ç•ªä¸Šã«ã‚ã£ãŸã®ã§ã€data ã¯ Query å‹ã«ã—ã¾ã—ãŸ

```graphql
{
  "data": {
    "pokemon": {
      ...
    }
  }
}
```

ç°¡å˜ã«èª¬æ˜ã—ã¦ã„ãã¾ã™

#### useQuery

```tsx
import { useQuery } from "@apollo/client";
const { loading, error, data } = useQuery<Query>(searchPikachu);
```

Apollo ãŒç”¨æ„ã—ã¦ãã‚Œã¦ã„ã‚‹ Hooks ã§ã™
é€šä¿¡ã®çŠ¶æ³ã«å¿œã˜ã¦ loading,error,data ã®å€¤ãŒå¤‰ã‚ã‚‹ã®ã§ã¨ã¦ã‚‚ä¾¿åˆ©

#### ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```tsx
if (loading) return <>Loading...</>;
if (error) return <>Error! {error.message}</>;
```

loading ãŒ true ã®å ´åˆã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã®æ–‡å­—ã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”å´ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™

`<></>`ã“ã‚Œã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã¨è¡Œã£ã¦ã¨ã‚Šã‚ãˆãšå›²ã¿ãŸã„æ™‚ã«ä½¿ã„ã¾ã™ã€€ã¨ã¦ã‚‚ä¾¿åˆ©

#### ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤º

ãƒ†ã‚¹ãƒˆãªã®ã§ç‰¹åˆ¥ãªãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ã‹ã¯ã›ãšã€?.ã§ã”ã‚ŠæŠ¼ã—ã¦ã¾ã™
img ã ã‘ src ã¨ alt ã« undifind ã‚’æ¸¡ã›ãªã‹ã£ãŸã®ã§ undifind ã®å ´åˆ no image.ã€€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸ

```tsx
return (
  <div>
    <div>No: {data?.pokemon?.number}</div>
    <div>Name: {data?.pokemon?.name}</div>
    {data?.pokemon?.image ? (
      <img src={data?.pokemon?.image} alt={data?.pokemon?.name ?? ""} />
    ) : (
      <div>no image.</div>
    )}
  </div>
);
```

ã“ã“ã¾ã§ã§ Pikachu ã®ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-05-06 1.25.01.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/461616/6b2fb449-f2db-f3ee-0605-a38ff1d6f9b8.png)

### å‹•çš„ã«ãƒã‚±ãƒ¢ãƒ³ã®åå‰ãŒå‹•çš„ã«è¨­å®šã§ãã‚‹ã‚ˆã†ã«ã—ã‚ˆã†

ã“ã“ã¾ã§ã§çµæœã‚’å–å¾—ã€è¡¨ç¤ºãŒã§ãã¾ã—ãŸ
ã‚ã¨ã¯ Pikachu ä»¥å¤–ã®ãƒã‚±ãƒ¢ãƒ³ã‚‚èª¿ã¹ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ãŸã„ã®ã§ã€æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œã£ã¦å‹•çš„ã«ãƒã‚±ãƒ¢ãƒ³ã‚’æ¤œç´¢ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™

ã¾ãšã¯ GraphiQL ã§å¤‰æ•°ã‚’ä½¿ã£ãŸ Query ã‚’ä½œæˆã—ã¦ã¿ã¾ã™

#### å¤‰æ•°ã‚’ä½¿ã£ãŸ Query

Query ã«å¤‰æ•°ã‚’æ¸¡ã™ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¼‰ã—ã¾ã™

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-05-05 21.46.06.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/461616/8ad8c02e-f06d-b538-feb2-7158f7c52681.png)
-2a9914945eb4.png)

å·¦ä¸‹ã® QUERY VARIABLES ã§å¤‰æ•°ã« Charizard ã‚’å…¥ã‚Œã¦ã€ãã‚Œã‚’å·¦ä¸Šã® query ã§ä½¿ç”¨ã—ã¦ã„ã¾ã™
æ¤œç´¢çµæœãŒ 006 Charizard ã«ãªã£ãŸã®ãŒã‚ã‹ã‚Šã¾ã™ã­

src/graphql/queries.ts ã«è¿½åŠ ã—ã¦ãŠãã¾ã—ã‚‡ã†

```src/graphql/queries.ts
export const searchPokemon = gql`
    query searchPokemon($name: String) {
        pokemon(name: $name) {
            number
            name
            image
        }
    }
`
```

#### æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆ

src/components/SearchForm.tsx ã‚’ä½œæˆã—ã€æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œã£ã¦ã„ãã¾ã™

```src/components/SearchForm.tsx
import { FormEvent, useRef } from "react"

type PropType = {
    setpokemonName: React.Dispatch<React.SetStateAction<string>>
}

const SearchForm: React.FC<PropType> = ({ setpokemonName }) => {
    const ref = useRef<HTMLInputElement>(null)

    const submitHandler = (e: FormEvent) => {
        e.preventDefault()
        if (ref !== null && ref.current !== null) {
            setpokemonName(ref.current.value)
        }
    }

    return (
        <form onSubmit={submitHandler}>
            <input type="text" ref={ref} placeholder="input Pokemon's name" />
            <input type="submit" value="Search"></input>
        </form>
    )
}

export { SearchForm }
```

src/App.tsx ã‚‚ã“ã‚Œã«ä¼´ã„ä¿®æ­£

```src/App.tsx
function App() {
    const [pokemonName, setpokemonName] = useState("")

    return (
        <> // è¿½åŠ 
            <SearchForm setpokemonName={setpokemonName}></ SearchForm> // å¤‰æ›´
            <ApolloProvider client={apolloClient}>
                <SearchResultField></SearchResultField>
            </ApolloProvider>
        </> // è¿½åŠ 
    )
}
```

React ã®è§£èª¬è¨˜äº‹ã§ã¯ç„¡ã„ã®ã§è©³ç´°ãªèª¬æ˜ã¯çœãã¾ã™ãŒã€

- input:text ã‚’ useRef Hooks ã§å®šç¾©
- form ã® onSubmit ã§ ref ã‚’å‚ç…§ã—ã€value ã‚’å–å¾—ã—ã¦ã„ã‚‹
- App.tsx ã§ useState ã§ä½œæˆã—ãŸ pokemonName ã®ã‚»ãƒƒã‚¿ãƒ¼ï¼Ÿã‚’æ¸¡ã—ã¦ã€onSubmit ã§ãã“ã« value ã‚’çªã£è¾¼ã‚€

ã£ã¦æ„Ÿã˜ã®ãƒ•ã‚©ãƒ¼ãƒ ã«ã—ã¦ã„ã¾ã™
Submit ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã€ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã®å€¤ãŒ App.tsx ã® pokemonName ã«ã€å…¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ

#### æ¤œç´¢æ¡ä»¶ã‚’å‹•çš„ãªå€¤ã«è¨­å®šã™ã‚‹

ã•ã¦ã€æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å—ã‘å–ã£ãŸ pokemonName ã‚’ä½¿ã£ã¦æ¤œç´¢çµæœã‚’è¡¨ç¤ºã—ã¾ã—ã‚‡ã†

```src/components/SearchResultField.tsx
// â†“è¿½åŠ 
type PropType = {
    pokemonName: string
}

const SearchResultField: React.FC<PropType> = ({  pokemonName }) => { // å¤‰æ›´
    const { loading, error, data } = useQuery<Query> (searchPokemon, { variables: { name: pokemonName } }) // å¤‰æ›´

    if (!pokemonName) return <></> // è¿½åŠ 
    if (loading) return <>Loading...</>
    if (error) return <>Error! {error.message}</>
    if (!data || !data.pokemon) return <>No Data.</> // è¿½åŠ 

    // â†“å¤‰æ›´
    return (
        <>
            <div>No: {data.pokemon.number}</div>
            <div>Name: {data.pokemon.name}</div>
            {data.pokemon.image ? <img src={data.pokemon.image} alt={data.pokemon.name ?? ""} /> : <div>no image.</div>}
        </>
    )
}
```

`useQuery<Query> (searchPokemon, { variables: { name: pokemonName } })`
useQuery ã« searchPokemon ã‚’ç¬¬ä¸€å¼•æ•°ã§æ¸¡ã—ã€ç¬¬äºŒå¼•æ•°ã« variables ã‚’ä¿æŒã—ãŸ Object ã‚’æ¸¡ã—ã¦ã„ã¾ã™
ã“ã® variables ã«ã¯å…ˆã»ã© GraphiQL ã®å·¦ä¸‹ã§ã® QUERY VARIABLES ã§ç¢ºèªã—ãŸç‰©ã¨åŒã˜å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã—ã¾ã™
useQuery ã¯å¤‰æ•°ã¨ã—ã¦æ¸¡ã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚ã«å†åº¦ Query ã‚’å®Ÿè¡Œã—ã¦ãã‚Œã‚‹ã®ã§ã€ã“ã‚Œã§æ¤œç´¢æ¡ä»¶ã‚’å¯å¤‰ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸ

æœ€å¾Œã« App.tsx ã‹ã‚‰ pokemonName ã‚’æ¸¡ã—ã¾ã™
ã¤ã„ã§ã« pokemonName ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½•ã‚‚è¡¨ç¤ºã—ãªã„ã‚ˆã†ã«ã—ã¾ã—ãŸ

```App.tsx
<ApolloProvider client={apolloClient}>
    {pokemonName && <SearchResultField pokemonName={pokemonName}> // å¤‰æ›´</SearchResultField>}
</ApolloProvider>
```

ã“ã‚Œã§ Submit ãŒæŠ¼ã•ã‚Œã‚‹åº¦ã«æ¤œç´¢çµæœãŒæ›´æ–°ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼

![pokemon-qiita-mov.gif](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/461616/04ed0ff6-45d8-c2bf-9c88-788765d08c9f.gif)

## ã¾ã¨ã‚

React + TypeScript + GraphQL ã§ãƒã‚±ãƒ¢ãƒ³ã®ç”»åƒæ¤œç´¢ãŒã§ãã‚‹ç°¡æ˜“çš„ãªã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã—ãŸ

å¤§å¥½ããªãƒã‚±ãƒ¢ãƒ³ã§ GraphQL ã‚’å‹‰å¼·å‡ºæ¥ã¦ã€[graphql-pokemon](https://github.com/lucasbento/graphql-pokemon)ã®ä½œè€…ã«ã¯æ„Ÿè¬ã—ã¦ã‚‚ã—ãã‚Œã¾ã›ã‚“
ãŒã€æ¬²ã‚’è¨€ã†ãªã‚‰å…¨ãƒã‚±ãƒ¢ãƒ³ã«å¯¾å¿œã—ã¦æ¬²ã—ã„ãƒ»ãƒ»ãƒ»ã‚ã¨æ—¥æœ¬èªãƒ»ãƒ»ãƒ»

GraphQL ã®å‹‰å¼·ã®ã¤ã„ã§ã«ä½œã£ã¦ã¿ã¾ã—ãŸãŒã€GraphiQL æœ€é«˜ã™ãã‚‹ã—ã€graphql-code-generator ã§å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œã‚Œã‚‹ã®å¤©æ‰ã ã—ã€Apollo ãŒã¨ã¦ã‚‚ä½¿ã„ã‚„ã™ãã¦ã€ç°¡å˜ã§ã—ãŸ

GraphiQL ã®ãŠé™°ã§ REST API ã‚ˆã‚Šç°¡å˜ã«ãŠè©¦ã—ã§ãã‚‹ã®ã§ã€ã¨ã¦ã‚‚ã¨ã£ã¤ãã‚„ã™ã‹ã£ãŸã§ã™
ãŸã  GraphQL ã˜ã‚ƒãªã„ã¨å‡ºæ¥ãªã„ã“ã¨ã£ã¦ã„ã†ã®ãŒãã“ã¾ã§å†…å®¹ã«è¦‹å—ã‘ã‚‰ã‚Œã¾ã—ãŸ
æœ€è¿‘æµè¡Œã‚Šã® gRPC ã¨ã‹ã ã¨ REST ã§ã¯ã§ããªã„ã“ã¨ãŒå‡ºæ¥ãŸã‚Šã™ã‚‹ã¿ãŸã„ã§ã™
ã¨ã¦ã‚‚æ°—ã«å…¥ã£ãŸã®ã§ GraphQL ã«ã¯æ˜¯éã“ã‚Œã‹ã‚‰æµè¡Œã£ã¦æ¬²ã—ã„ã§ã™ãŒã€gRPC ã‚‚å‹‰å¼·ã—ã¦æµã‚Œã«ä¹—ã‚Šé…ã‚Œãªã„ã‚ˆã†ã«ã—ãªã„ã¨ã„ã‘ãªã„ãªã¨æ€ã„ã¾ã—ãŸãƒ»ãƒ»ãƒ»

ä»Šå›ã¯ query ã—ã‹ä½¿ã£ã¦ã„ã¾ã›ã‚“ãŒï¼ˆgraphql-pokemon ã«ã¯ query ã—ã‹ç”¨æ„ã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼‰
GitHub API ã¨ã‹ã«ã¯ mutation ã‚‚ã‚ã‚‹ã®ã§ mutation ã®è¨˜äº‹ã‚‚ãã®ã†ã¡æ›¸ããŸã„ã§ã™
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® GraphQL ã®æ›¸ãæ–¹ã‚‚å‹‰å¼·ã—ãªã„ã¨ãƒ»ãƒ»ãƒ»

## å‚è€ƒ

[graphql-pokemon](https://github.com/lucasbento/graphql-pokemon)

[graphql-pokemon ã® GraphiQL](https://graphql-pokemon2.vercel.app)

[graphql-code-generator å…¬å¼ Docs](https://www.graphql-code-generator.com/docs/getting-started/installation)

[GraphQL Code Generator ã®ä½¿ã„æ–¹ã€‚ã€œGraphQL ã® Schema ã‹ã‚‰ TS ã®å‹å®šç¾©ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ã€œ](https://qiita.com/ryo2132/items/601ec3c085fcd99658e5#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB)

[Apollo Docs](https://www.apollographql.com/docs/)
