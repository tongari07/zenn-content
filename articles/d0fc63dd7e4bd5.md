---
title: "プロジェクト内でのVRTの扱いを見直した"
emoji: "🐙"
type: "tech"
topics: []
published: false
---

僕が携わっているプロジェクトでのVRT（Visual Regression Testing）の実行するタイミングやどれほど担保するか

## それまで

また同時にVRTの扱いも見直しました。
それまではPR毎にCircle CI内でstorybookを立ち上げて画像をキャプチャしてAWS S3の前回の（正確には同一ブランチの前回のもの、ない場合は親ブランチの前回の物）と比較していました。しかしそれだと同一ブランチにpushするたびにワークフローが実行されてしまい負担になっていました。また、storyが増える毎にbuild-storybookやscreenshotの時間がかかるようになって、頻繁にCircle CIでのみタイムアウトエラーが発生するようになってしまいました。一時はタイムアウト時間を伸ばすことで解決していましたが、さすがに恒久対応することになりました。

そのプロジェクトではテストコードがあまり万全ではありませんでしたが、Storybookは充実していたため、VRTによる比較は重宝していました。それまでは月に１回リリースがあるかないかで、毎回そこそこ大きめリリースになっていたので、開発途中からなるべく品質を担保する必要がありました。そのためPR毎にVRTを実行し、毎回意図せずコンポーネント毎の挙動がおかしくなっていたりデザインの崩れが発生していないことを確認していました。
ある時から週１回以上はリリースをするようになって１回のリリースの範囲が狭くなりました。そのため、品質を担保しやすくなったため、VRTやE2Eの実行はPR毎ではなくリリース前のデグレ確認としてmaster-develop間に対しての手動実行で行うことしました。

