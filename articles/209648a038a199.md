---
title: "create-react-appのアプリケーションをmonorepoにした！"
emoji: "🐥"
type: "tech"
topics:
  - "cra"
published: false
---

## はじめに

この記事では、Create-react-appで構築したアプリケーション（admin）と、新たに作成する社内管理画面アプリケーション（backstage）をMonorepo構成に変更する方法を解説します。デザインシステムを共有しやすくするため、また複数のリポジトリを効率よく管理できるようにする目的で、Monorepo構成に変更を行います。

対象となる読者は、Create-react-appの基本について理解している方を想定しています。Monorepo構成への変更方法や、そのメリット・デメリットについて理解できるように説明していきますので、ぜひ最後までお読みください。

## Monorepo にしたかった理由

Monorepoへの移行を考えた大きな理由は、以下の2点にまとめられます。

### デザインシステムの共有

私たちのチームではデザインシステムを構築しており、既存のサービス管理画面（admin）でそれを利用していました。しかし、新たに社内管理画面（backstage）アプリケーションを作成することになった際、別リポジトリで構成するとデザインシステムを使い回すことが難しくなりました。そこで、Monorepo構成に変更し、共通で使用できるパッケージにデザインシステムを切り出すことで、どちらのアプリケーションでも簡単に利用できるようにしました。

### 複数リポジトリの効率的な管理

新たにアプリケーションを追加することで、リポジトリが増えることになりました。複数のリポジトリをそれぞれ管理するのは手間がかかり、効率が悪いと感じました。Monorepo構成にすることで、複数のアプリケーションやパッケージを1つのリポジトリで一元管理できるようになり、開発効率が向上しました。

## Monorepo への移行手順

Monorepoへの移行は以下の手順で行いました。

### 新しいリポジトリの作成

まずは、新しいリポジトリ「hogehoge-frontend」を作成しました。このリポジトリが、今後のMonorepo構成の基盤となります。

### Yarn Workspace の構築

次に、Yarn Workspaceを使って、リポジトリ内で複数のパッケージを効率的に管理できるようにしました。

#### 1. 新しいリポジトリの作成

まずは、新しいリポジトリを作成してください。GitHubやGitLabなどのバージョン管理システムを利用して、適切なリポジトリ名をつけて作成しましょう。

#### 2. Yarn のインストール

リポジトリ内でYarnを使えるようにするため、Yarnをインストールします。ターミナルで以下のコマンドを実行してください。

```sh
npm install -g yarn
```

#### 3. Yarn Workspace の設定

リポジトリのルートディレクトリにpackage.jsonファイルを作成し、Yarn Workspaceの設定を記述します。以下のような内容を追加してください。

```json
{
  "name": "hogehoge-frontend",
  "private": true,
  "workspaces": ["apps/*", "packages/*"]
}
```

上記の設定では、appsディレクトリとpackagesディレクトリ内のサブディレクトリがそれぞれワークスペースとして認識されます。

#### 4. アプリケーションとパッケージディレクトリの作成

次に、設定したディレクトリ（この例ではappsとpackages）を作成します。これらのディレクトリには、それぞれアプリケーションや共通パッケージのコードが格納されます。

```sh
mkdir apps packages
```

#### 5. 各ワークスペースに package.json を追加

アプリケーションやパッケージを作成したら、それぞれのディレクトリにpackage.jsonファイルを追加してください。これにより、各ワークスペースが独立したパッケージとして認識されます。

例）apps/adminディレクトリにpackage.jsonを追加する場合

```json
{
  "name": "admin",
  "version": "1.0.0",
  "main": "index.js",
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test"
  }
}
```

#### 6. 依存関係のインストール

最後に、プロジェクト全体で使う依存関係をインストールします。Yarn Workspaceでは、ルートディレクトリ

### 既存アプリケーション（admin）の移行

その後、既存のサービス管理画面（admin）のソースコードを、新しいリポジトリのapps/adminディレクトリに移動しました。さらに、Yarn Workspaceにadminパッケージを追加しました。

### 共通設定ファイルの切り出し

packages/config/ディレクトリに、新しいワークスペース「config」を追加しました。ここに、ts.config.jsやeslint.config.jsなどの共通設定ファイルを移動し、各アプリケーションでそれらをimportするように設定しました。

### デザインシステムの切り出し

packages/design-system/ディレクトリに、新しいワークスペース「design-system」を追加しました。そして、既存のデザインシステムフォルダ（apps/admin/src/design-system/）をここに移動させました。

### Turborepo の導入

Turborepoを導入して、ルートディレクトリから各パッケージのコマンドを実行できるようにしました。

### 新アプリケーション（backstage）の追加

最後に、新しい社内管理画面（backstage）アプリケーションをパッケージとして追加しました。

## 移行後のメリットとデメリット

Monorepo構成に移行することで得られるメリットとデメリットを検証しましょう。

### メリット

- デザインシステムの共有

Monorepo構成にすることで、デザインシステムを簡単に複数のアプリケーションで共有できるようになりました。これにより、一貫性のあるUIを維持しやすくなり、開発効率も向上します。

- リポジトリ管理の効率化
  複数のアプリケーションを1つのリポジトリで管理することで、開発チームはリポジトリ間の連携や同期を気にすることなく、開発に集中できます。

- 共通設定の集約
  共通の設定ファイルを1つの場所に集約することで、設定の変更や更新が容易になります。また、新しいアプリケーションを追加する際も、共通設定をすぐに適用できるため、開発がスムーズに進みます。

### デメリット

- 大規模なリポジトリの取り扱い
  Monorepo構成では、リポジトリが大規模になるため、クローンやビルドに時間がかかることがあります。適切なツールや設定を導入して、効率的にリポジトリを管理することが重要です。

- 学習コスト
  Monorepoに慣れていない開発者にとっては、構成やツールに慣れるまでに学習コストがかかることがあります。ただし、一度慣れてしまえば、開発の効率化が期待できるため、短期的なコストと捉えることができます。
