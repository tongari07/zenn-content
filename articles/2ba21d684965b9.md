---
title: "UIコンポーネントライブラリでスタイルを提供する方法"
emoji: "🏖️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: 
  -  "css"
  -  "frontend"
published: false
publication_name: "moneyforward"
---

複数のプロダクトやモノレポで共通利用するパッケージとして UI コンポーネントライブラリを作る時、技術選定似てどの方法を用いて開発するかが議題に上がります。当然選択した方法によって開発体験の良さや RSC に対応しているかなど比較する点は多くあります。しかしそれらの議論に進む前にまずスタイルを提供する方法を考える必要があります。

私は現在 40 以上あるプロダクトで共通利用されるデザインシステムの UI コンポーネントライブラリの開発に携わっています。そこで実際に上記のような議論が行われ、CSS Modules や Tailwind CSS、Zero-runtime CSS in JS などのさまざまなスタイリングの方法を横に並べて星取表を作り、メンバーそれぞれの観点や好みでどれを選択するかを議論していました。しかし、そもそもどのようにスタイルを提供するかを最初に決めていなかったため、議論が収束しないことに気づきました。そこで改めてスタイルを提供する方法を調査しメンバーに共有し再度議論したところ、議論はスムーズに収束しました。

この記事ではその際に調べた方法とそれらのメリット・デメリットをまとめて比較します。
少しでも皆様の技術選定の助けになれば幸いです。

## スタイルを提供する方法の選択肢

内部で利用するライブラリに関わらず、UI コンポーネントライブラリやパッケージとして提供する上で使う側がどのようにスタイルを利用するかを選択する必要があります。プロジェクトの状態にもよって取れる選択肢は変わってきます。考えられる選択肢としては下記があります。

- 1 つの CSS ファイルを提供する
- 各コンポーネントの CSS ファイルをそれぞれ提供する
- スタイリングライブラリのプリセットとして提供する
- CSS in JS として提供する

### 1つのCSSファイルを提供する

ライブラリ側で 1 つの CSS ファイルをエクスポートして、アプリケーション側ではその CSS ファイルを自身のグローバルな CSS ファイルでインポートします。スタイリングライブラリを利用する場合、ビルド時に静的な CSS ファイルを生成します。

```css:アプリケーション側でグローバルなスタイルを定義する global.css 内でインポートしている例

@import url('@tongari/my-components/styles.css');
```

この方法ではシンプルな方法であることが挙げられます。アプリケーション側では 1 つのファイルのみをインポートし、global.css 内に 1 行するだけで全てのコンポーネントは最初からスタイルが当たった状態になります。
また静的な CSS ファイルを提供するため、アプリケーション側のスタイリングの方法に関わらず利用できます。当然、React Server Component などのサーバーでレンダリングされるコンポーネントでも利用できます。
ライブラリ側で利用するスタイリングの方法に関しても制限はなく、 Pure な CSS を利用したり、CSS Modules やスタイリングライブラリを利用する方法まで幅広い選択肢があります。

一方で全てのスタイルを 1 つにまとめて提供するため、コンポーネントの数が増えてスタイルが多くなるにつれて CSS ファイルのサイズが大きくなってしまい、利用していないコンポーネントのスタイルも全て含んだファイルがインポートされてしまいます。使っているスタイリングライブラリによっては重複するスタイルをまとめてることができたり、何らかの手段で CSS ファイルを圧縮することで、ある程度はファイルサイズを減らすことができますが、それでも限界はあります。

しかし、CSS ファイルのサイズがパフォーマンスに与える影響はその他の要因と比べて比較的小さく、共通利用が目的の UI コンポーネントライブラリではプロダクトと比べてもスタイルが複雑になりにくいです。そのため下記の他の選択肢と比べるとデメリットは少ないと言えます。

### 各コンポーネントの CSS ファイルをそれぞれ提供する

この方法では提供するコンポーネント毎に CSS ファイルを用意し、コンポーネントの js ファイルや型定義ファイルと一緒にエクスポートします。アプリケーション側ではコンポーネントをインポートする際に CSS ファイルも一緒にインポートします。

```tsx:アプリケーション側でコンポーネントをインポートしたファイル内でインポートしている例
import { Button as CommonButton } from '@tongari07/my-components/Button';
import '@tongari07/my-components/Button/styles.css';

export const Button = (props) => {
  return <CommonButton {...props}/>
}
```

この方法ではアプリケーション側はコンポーネント毎のスタイルのみが定義された CSS ファイルをインポートするので、バンドルサイズを小さくできます。さらに Next.js などのビルド時にページ毎に CSS ファイルをまとめるなどの最適化を行うフレームワークを利用している場合、最適化の対象になります。パフォーマンスを重要視した時に最も有力な方法となるでしょう。
加えて、1 つの CSS ファイルを提供する方法と同様に、静的な CSS ファイルを提供するため、サーバーでレンダリングされるコンポーネントでも利用できます。

一方で、アプリケーション側では新しいコンポーネントをインポートするたびに CSS も同じようにインポートする必要があります。上記の例のようにラッパーとなるコンポーネントを用意するか、グローバルな CSS ファイルにそれぞれ 1 つずつインポートする必要があります。アプリケーション側にラッパーとなるコンポーネントを作ることを強要したくない場合は、別の手段を取ることを推奨します。

また調査した限りそれぞれのコンポーネントの CSS ファイルを別々に生成できる CSS in JS ライブラリが見つからず、おそらくこの方法はピュアな CSS か CSS Modules を利用することが前提になります。そのため、これはスタイリングの方法のメリデメになりますが、型安全に開発できません。（CSS Modules には型安全にする方法がサードパーティライブラリとして存在しますが、CSS in JS と比べると型の推論は弱い印象です）。

### スタイリングライブラリのプリセットとして提供する

Tailwind CSS や CSS in JS ライブラリのプリセットをエクスポートし、アプリケーション側はそれを自身のライブラリの設定ファイルにてインポートして組み込みます。コンポーネントよりも低レイヤーな、いわゆるデザイントークンや特定のパターンにおけるスタイルのセットを提供する場合に有効です。また、同じ設定ファイルを利用してコンポーネントを実装してそのまま JavaScript ファイルとして提供し、アプリケーション側で自身のプロジェクトのコードと一緒にビルドすることで、ライブラリ側でのビルド無しでコンポーネントを提供できます。

この方法の最大のメリットは、アプリケーション側でビルドするためライブラリの最適化のメリットを最大限に享受できることでしょう。例えば Tailwind CSS や Panda CSS では、ビルド時に重複しているスタイルを排除して CSS ファイルを生成してくれますが、この最適化にライブラリのコンポーネントも含めることができます。

一方でこの方法で提供されたコンポーネントを利用する場合、上述の通りアプリケーション側でビルドする必要があります。すでに同じスタイリングライブラリを利用している場合は問題ありませんが、違うスタイリングライブラリを利用している場合、新たにインストールしてビルドプロセスに含める必要があります。また、同じライブラリを利用している場合も、ライブラリで提供している設定と既存の設定の間に競合が発生するリスクがあります。そのためできるだけ同じライブラリを利用していることが好ましいです。

アプリケーション側のスタイリングライブラリが統一されている場合や、ライブラリの導入と同時にスタイリングライブラリを移行できる場合は、パフォーマンスや利用のしやすさを考慮すると非常に良い選択肢と言えます。

pixiv 様のデザインシステムでの実例を参考にさせていただきました。
https://inside.pixiv.blog/2022/03/31/120000

### CSS in JS として提供する

この方法では CSS ではなく、CSS in JS ライブラリを利用してコンポーネント内部でスタイルを定義したものをそのまま JavaScript ファイルとして提供します。RSC などのサーバーでレンダリングされるコンポーネントが出る以前のメジャーな方法です。主に Emotion や styled-components などを利用するのが一般的です。

この方法のメリット・デメリットはすでに多くの記事が出ていますので、ここでは省略します。
UI コンポーネントライブラリで利用することを考えた場合、RSC で使えないことは利用できる環境を制限してしまうため、大きなデメリットとなります。正確には MUI や Chakra UI が行なっているように、全てのコンポーネントをクライアントコンポーネントとして提供することで RSC の環境下でも利用できますが、最適化が行えなくなるためアプリケーション側のメリットを無くしてしまいます。

これらの理由から今後も RSC などを利用しない事を前提とした場合や上記のデメリットを享受できる場合以外では、この方法を利用するメリットはないと言えるでしょう。

こちらの記事が非常に参考になりました。
https://zenn.dev/poteboy/articles/e9f63b87b3cd69

## まとめ

以上のそれぞれのメリット/デメリットをまとめると下記のようになります。

 観点\方法|1 つの CSS ファイルを提供する | 各コンポーネントの CSS ファイルをそれぞれ提供する| スタイリングライブラリのプリセットとして提供する | CSS in JS として提供する
-|-|-|-|-
導入のしやすさ|a|b|c|d
パフォーマンス|a|b|c|d
RSCへの対応|○|○|○|✖︎

## 参考文献

https://inside.pixiv.blog/2022/03/31/120000
https://zenn.dev/poteboy/articles/e9f63b87b3cd69
